# æ•ŒäººçŠ¶æ€æœº æŠ€æœ¯æ–‡æ¡£

æœ¬æ–‡æ¡£é¢å‘å¼€å‘ä¸å…³å¡/ç¾æœ¯ï¼Œç³»ç»Ÿæ€§é˜è¿°å½“å‰æ•ŒäººçŠ¶æ€æœºçš„æ¶æ„ã€æ•°æ®æµã€çŠ¶æ€è®¾è®¡ã€ä½¿ç”¨ä¸æ‰©å±•æ–¹å¼ã€‚

- ä»£ç æ ¹ç›®å½•ï¼š`Assets/Scripts/5_EnemyStateMachine`
- ä¸»è¦ç±»å‹ï¼š
  - `EnemyStateMachine`ï¼ˆçŠ¶æ€æœºç®¡ç†å™¨ï¼‰
  - `IEnemyState`ã€`EnemyStateBase`ï¼ˆçŠ¶æ€æ¥å£ä¸åŸºç±»ï¼‰
  - `EnemyController`ï¼ˆæ•Œäººæ§åˆ¶å™¨æŠ½è±¡åŸºç±»ï¼‰
  - `GenericEnemyController`ï¼ˆé€šç”¨æ•Œäººæ§åˆ¶å™¨ï¼‰
  - åœ°é¢çŠ¶æ€ï¼š`GroundEnemyIdleState`ã€`GroundEnemyPatrolState`ã€`GroundEnemyChaseState`ã€`GroundEnemyAttackState`
  - é£è¡ŒçŠ¶æ€ï¼š`AirEnemyPatrolState`ã€`AirEnemyChaseState`ã€`AirEnemyAttackState`
  - é€šç”¨çŠ¶æ€ï¼š`EnemyHurtState`ã€`EnemyDeathState`

**çŠ¶æ€æœºå¯è§†åŒ–å·¥å…·**ï¼šæœ¬ç³»ç»Ÿé…å¤‡äº†ä¸€ä¸ªç±»ä¼¼Unity Animatorçš„Canvasé£æ ¼å¯è§†åŒ–ç¼–è¾‘å™¨çª—å£ï¼ˆå¿«æ·é”® `Ctrl+Shift+V`ï¼‰ï¼Œæä¾›å®æ—¶çŠ¶æ€èŠ‚ç‚¹å›¾ã€è½¬æ¢å…³ç³»å¯è§†åŒ–ã€è¿è¡Œæ—¶è°ƒè¯•é¢æ¿å’Œäº¤äº’å¼çŠ¶æ€åˆ‡æ¢åŠŸèƒ½ï¼Œå¸®åŠ©å¼€å‘è€…å’Œè®¾è®¡å¸ˆç›´è§‚ç†è§£å’Œè°ƒè¯•æ•Œäººè¡Œä¸ºé€»è¾‘ï¼Œæ”¯æŒç”»å¸ƒæ‹–æ‹½ã€ç¼©æ”¾ã€è‡ªåŠ¨å¸ƒå±€ç­‰æ“ä½œï¼Œæ‰€æœ‰çŠ¶æ€ä½¿ç”¨é¢œè‰²ç¼–ç å’Œå›¾æ ‡æ ‡è¯†ï¼Œè¿è¡Œæ—¶å¯ç‚¹å‡»èŠ‚ç‚¹å¼ºåˆ¶åˆ‡æ¢çŠ¶æ€è¿›è¡Œå¿«é€Ÿæµ‹è¯•ã€‚

---

## 1. ç±»å›¾ï¼ˆClass Diagramï¼‰

```mermaid
classDiagram
    class EnemyController {
        <<abstract>>
        +StateMachine : EnemyStateMachine
        +CurrentHealth : float
        +MaxHealth : float
        +IsAlive : bool
        +CanAct : bool
        +IsFacingRight : bool
        #rigidBody : Rigidbody2D
        #animator : Animator
        +TakeDamage(damage, source)
        +SetFacingDirection(right)
        +ApplyKnockback(force, direction)
        #RegisterStates()*
        #PlayAnimation(name)*
        #MoveTowards(target, speed)*
        #DetectPlayer(range)* bool
        #GetPlayerTarget()* GameObject
        #OnTakeDamage(damage, source)*
        #OnDeath()*
    }

    class GenericEnemyController {
        -enemyType : EnemyType
        -enabledStates : List~StateConfig~
        -initialState : string
        -playerDetectionRange : float
        -patrolSpeed : float
        -chaseSpeed : float
        -attackRange : float
        -allRenderers : Renderer[]
        -originalColors : Dictionary
        +GetMainRenderer() Renderer
        +GetAllRenderers() Renderer[]
        -CreateIdleState() IEnemyState
        -CreatePatrolState() IEnemyState
        -CreateChaseState() IEnemyState
        -CreateAttackState() IEnemyState
        -CreateHurtState() IEnemyState
        -CreateDeathState() IEnemyState
    }

    class EnemyStateMachine {
        -states : Dictionary~string, IEnemyState~
        -currentState : IEnemyState
        -owner : EnemyController
        +CurrentStateName : string
        +StateCount : int
        +RegisterState(state) bool
        +HasState(name) bool
        +GetState(name) IEnemyState
        +TransitionTo(name) bool
        +ForceTransitionTo(name) bool
        +Update()
        +FixedUpdate()
    }

    class IEnemyState {
        <<interface>>
        +StateName : string
        +OnEnter(enemy)
        +OnUpdate(enemy)
        +OnFixedUpdate(enemy)
        +OnExit(enemy)
        +CanTransitionTo(target, enemy) bool
    }

    class EnemyStateBase {
        <<abstract>>
        +StateName : string*
        #stateTimer : float
        #debugMode : bool
        +OnEnter(enemy)
        +OnUpdate(enemy)
        +OnFixedUpdate(enemy)
        +OnExit(enemy)
        #InitializeState(enemy)*
        #UpdateState(enemy)*
        #FixedUpdateState(enemy)*
        #CheckTransitionConditions(enemy)*
        #CleanupState(enemy)*
    }

    class GroundEnemyIdleState {
        -idleTimeout : float
        -detectionRange : float
    }

    class GroundEnemyPatrolState {
        -patrolSpeed : float
        -patrolDuration : float
        -maxPatrolDistance : float
    }

    class GroundEnemyChaseState {
        -chaseSpeed : float
        -attackRange : float
        -detectionRange : float
    }

    class GroundEnemyAttackState {
        -attackRange : float
        -attackCooldown : float
        -chaseRange : float
    }

    class AirEnemyPatrolState {
        -patrolMode : AirPatrolMode
        -patrolRadius : float
    }

    class AirEnemyChaseState {
        -chaseMode : AirChaseMode
        -chaseSpeed : float
    }

    class AirEnemyAttackState {
        -attackMode : AirAttackMode
        -attackRange : float
    }

    class EnemyHurtState {
        -hurtDuration : float
        -flashDuration : float
        -flashCount : int
        -knockbackForce : float
        +DamageSource : Vector3
    }

    class EnemyDeathState {
        -deathDelay : float
        -fadeOutDuration : float
        -flashInterval : float
        -deathColor : Color
    }

    EnemyController <|-- GenericEnemyController
    EnemyController o--> EnemyStateMachine
    EnemyStateMachine --> IEnemyState : manages
    IEnemyState <|.. EnemyStateBase
    EnemyStateBase <|-- GroundEnemyIdleState
    EnemyStateBase <|-- GroundEnemyPatrolState
    EnemyStateBase <|-- GroundEnemyChaseState
    EnemyStateBase <|-- GroundEnemyAttackState
    EnemyStateBase <|-- AirEnemyPatrolState
    EnemyStateBase <|-- AirEnemyChaseState
    EnemyStateBase <|-- AirEnemyAttackState
    EnemyStateBase <|-- EnemyHurtState
    EnemyStateBase <|-- EnemyDeathState
```

---

## 2. çŠ¶æ€å›¾ï¼ˆState Diagramï¼‰

```mermaid
stateDiagram-v2
    [*] --> Idle : åˆå§‹åŒ–

    state "æ­£å¸¸è¡Œä¸º" as Normal {
        Idle --> Patrol : å¾…æœºè¶…æ—¶
        Idle --> Chase : å‘ç°ç©å®¶
        
        Patrol --> Idle : å·¡é€»ç»“æŸ
        Patrol --> Chase : å‘ç°ç©å®¶
        
        Chase --> Attack : è¿›å…¥æ”»å‡»èŒƒå›´
        Chase --> Patrol : ç›®æ ‡ä¸¢å¤±
        
        Attack --> Chase : ç¦»å¼€æ”»å‡»èŒƒå›´
        Attack --> Patrol : ç¦»å¼€è¿½å‡»èŒƒå›´
    }

    state "å—ä¼¤å¤„ç†" as HurtProcess {
        Hurt : é—ªçº¢æ•ˆæœ
        Hurt : å‡»é€€å¤„ç†
    }

    state "æ­»äº¡å¤„ç†" as DeathProcess {
        Death : å˜é»‘
        Death : ç¦ç”¨ç©å®¶ç¢°æ’
        Death : ç­‰å¾…2ç§’
        Death : é—ªçƒæ¶ˆå¤±
    }

    Normal --> HurtProcess : å—åˆ°ä¼¤å®³
    HurtProcess --> Chase : ç©å®¶åœ¨èŒƒå›´å†…
    HurtProcess --> Patrol : ç©å®¶ä¸åœ¨èŒƒå›´å†…

    Normal --> DeathProcess : è¡€é‡å½’é›¶
    DeathProcess --> [*] : é”€æ¯å¯¹è±¡
```

---

## 3. æ—¶åºå›¾ï¼ˆSequence Diagramï¼‰

### 3.1 çŠ¶æ€åˆ‡æ¢æ—¶åº

```mermaid
sequenceDiagram
    participant Player as ç©å®¶
    participant Enemy as æ•Œäººæ§åˆ¶å™¨
    participant SM as çŠ¶æ€æœº
    participant OldState as æ—§çŠ¶æ€
    participant NewState as æ–°çŠ¶æ€

    Player->>Enemy: è¿›å…¥æ£€æµ‹èŒƒå›´
    Enemy->>SM: TransitionTo("Chase")
    SM->>SM: HasState("Chase")?
    SM->>OldState: OnExit(enemy)
    OldState->>OldState: CleanupState()
    SM->>NewState: OnEnter(enemy)
    NewState->>NewState: InitializeState()
    NewState->>Enemy: PlayAnimation("Chase")
    SM-->>Enemy: çŠ¶æ€åˆ‡æ¢å®Œæˆ
```

### 3.2 å—ä¼¤å¤„ç†æ—¶åº

```mermaid
sequenceDiagram
    participant Player as ç©å®¶
    participant Enemy as æ•Œäººæ§åˆ¶å™¨
    participant SM as çŠ¶æ€æœº
    participant HurtState as å—ä¼¤çŠ¶æ€
    participant Renderer as æ¸²æŸ“å™¨

    Player->>Enemy: æ”»å‡»å‘½ä¸­
    Enemy->>Enemy: TakeDamage(damage, source)
    Enemy->>Enemy: OnTakeDamage()
    Enemy->>SM: ForceTransitionTo("Hurt")
    SM->>HurtState: OnEnter(enemy)
    
    loop é—ªçº¢æ•ˆæœ x3
        HurtState->>Renderer: SetColor(Red)
        HurtState->>HurtState: Wait(0.1s)
        HurtState->>Renderer: SetColor(Original)
        HurtState->>HurtState: Wait(0.1s)
    end
    
    HurtState->>Enemy: ApplyKnockback()
    HurtState->>SM: TransitionTo(nextState)
```

### 3.3 æ­»äº¡å¤„ç†æ—¶åº

```mermaid
sequenceDiagram
    participant Enemy as æ•Œäººæ§åˆ¶å™¨
    participant SM as çŠ¶æ€æœº
    participant DeathState as æ­»äº¡çŠ¶æ€
    participant Renderer as æ¸²æŸ“å™¨
    participant Collider as ç¢°æ’ä½“
    participant GO as GameObject

    Enemy->>Enemy: CurrentHealth <= 0
    Enemy->>Enemy: OnDeath()
    Enemy->>SM: ForceTransitionTo("Death")
    SM->>DeathState: OnEnter(enemy)
    
    DeathState->>Renderer: SetColor(Black)
    DeathState->>Collider: IgnoreCollision(Player)
    DeathState->>Enemy: StopMovement()
    
    DeathState->>DeathState: Wait(2s)
    
    loop é—ªçƒæ¶ˆå¤±
        DeathState->>Renderer: SetEnabled(false)
        DeathState->>DeathState: Wait(0.1s)
        DeathState->>Renderer: SetEnabled(true)
        DeathState->>DeathState: Wait(0.1s)
    end
    
    DeathState->>GO: Destroy()
```

---

## 4. E-Rå›¾ï¼ˆEntity-Relationship Diagramï¼‰

```mermaid
erDiagram
    ENEMY_CONTROLLER ||--|| ENEMY_STATE_MACHINE : owns
    ENEMY_STATE_MACHINE ||--o{ ENEMY_STATE : manages
    ENEMY_CONTROLLER ||--o{ RENDERER : has
    ENEMY_CONTROLLER ||--o{ COLLIDER : has
    ENEMY_CONTROLLER }o--|| PLAYER : detects

    ENEMY_CONTROLLER {
        string enemyName
        float currentHealth
        float maxHealth
        bool isAlive
        bool canAct
        bool isFacingRight
        EnemyType enemyType
    }

    ENEMY_STATE_MACHINE {
        string currentStateName
        int stateCount
    }

    ENEMY_STATE {
        string stateName
        float stateTimer
        bool debugMode
    }

    RENDERER {
        Color color
        bool enabled
    }

    COLLIDER {
        bool enabled
        bool isTrigger
    }

    PLAYER {
        string tag
        Vector3 position
    }

    STATE_CONFIG ||--|| ENEMY_STATE : configures
    STATE_CONFIG {
        string stateName
        bool enabled
        string description
    }

    GROUND_STATE ||--|{ ENEMY_STATE : extends
    GROUND_STATE {
        LayerMask groundLayer
        LayerMask wallLayer
        float patrolSpeed
        float chaseSpeed
    }

    AIR_STATE ||--|{ ENEMY_STATE : extends
    AIR_STATE {
        AirPatrolMode patrolMode
        AirChaseMode chaseMode
        AirAttackMode attackMode
        float flyHeight
    }
```

---

## 5. é²æ£’å›¾ï¼ˆRobustness Diagramï¼‰

```mermaid
flowchart LR
    subgraph Actors
        Player((ç©å®¶))
        Designer((ç­–åˆ’))
    end

    subgraph Boundary
        Inspector[Inspectoré¢æ¿]
        Gizmos[Scene Gizmos]
        DebugLog[è°ƒè¯•æ—¥å¿—]
    end

    subgraph Control
        EnemyController{æ•Œäººæ§åˆ¶å™¨}
        StateMachine{çŠ¶æ€æœº}
        StateFactory{çŠ¶æ€å·¥å‚}
        DetectionSystem{æ£€æµ‹ç³»ç»Ÿ}
        DamageSystem{ä¼¤å®³ç³»ç»Ÿ}
    end

    subgraph Entity
        EnemyData[(æ•Œäººæ•°æ®)]
        StateData[(çŠ¶æ€æ•°æ®)]
        ConfigData[(é…ç½®æ•°æ®)]
    end

    Player -->|æ”»å‡»| DamageSystem
    Player -->|ç§»åŠ¨| DetectionSystem
    Designer -->|é…ç½®| Inspector

    Inspector --> ConfigData
    Inspector --> EnemyController
    
    EnemyController --> StateMachine
    EnemyController --> DetectionSystem
    EnemyController --> DamageSystem
    
    StateMachine --> StateFactory
    StateFactory --> StateData
    
    DetectionSystem --> EnemyData
    DamageSystem --> EnemyData
    
    StateMachine --> Gizmos
    StateMachine --> DebugLog
```

---

## 6. ç”˜ç‰¹å›¾ï¼ˆGantt Chartï¼‰- å¼€å‘è¿›åº¦

```mermaid
gantt
    title æ•ŒäººçŠ¶æ€æœºå¼€å‘è¿›åº¦
    dateFormat  YYYY-MM-DD
    section åŸºç¡€æ¶æ„
    çŠ¶æ€æœºæ ¸å¿ƒ           :done, core, 2024-01-01, 3d
    çŠ¶æ€æ¥å£è®¾è®¡         :done, interface, after core, 2d
    æ§åˆ¶å™¨åŸºç±»           :done, controller, after interface, 3d
    
    section åœ°é¢æ•ŒäººçŠ¶æ€
    IdleçŠ¶æ€            :done, g_idle, 2024-01-09, 2d
    PatrolçŠ¶æ€          :done, g_patrol, after g_idle, 3d
    ChaseçŠ¶æ€           :done, g_chase, after g_patrol, 3d
    AttackçŠ¶æ€          :done, g_attack, after g_chase, 3d
    
    section é£è¡Œæ•ŒäººçŠ¶æ€
    AirPatrolçŠ¶æ€       :done, a_patrol, 2024-01-20, 3d
    AirChaseçŠ¶æ€        :done, a_chase, after a_patrol, 3d
    AirAttackçŠ¶æ€       :done, a_attack, after a_chase, 3d
    
    section é€šç”¨çŠ¶æ€
    HurtçŠ¶æ€            :done, hurt, 2024-01-30, 2d
    DeathçŠ¶æ€           :done, death, after hurt, 2d
    
    section åç»­è®¡åˆ’
    BossçŠ¶æ€            :active, boss, 2024-02-05, 5d
    æŠ€èƒ½ç³»ç»Ÿ            :skill, after boss, 7d
    AIä¼˜åŒ–              :ai, after skill, 5d
```

---

## 7. æ´»åŠ¨å›¾ï¼ˆActivity Diagramï¼‰- çŠ¶æ€æ›´æ–°æµç¨‹

```mermaid
flowchart TD
    Start([Updateå¼€å§‹]) --> CheckAlive{æ•Œäººå­˜æ´»?}
    
    CheckAlive -->|å¦| End([ç»“æŸ])
    CheckAlive -->|æ˜¯| CheckCanAct{å¯ä»¥è¡ŒåŠ¨?}
    
    CheckCanAct -->|å¦| End
    CheckCanAct -->|æ˜¯| UpdateTimer[æ›´æ–°çŠ¶æ€è®¡æ—¶å™¨]
    
    UpdateTimer --> CallUpdate[è°ƒç”¨å½“å‰çŠ¶æ€Update]
    CallUpdate --> CheckTransition[æ£€æŸ¥çŠ¶æ€è½¬æ¢æ¡ä»¶]
    
    CheckTransition --> HasTransition{éœ€è¦è½¬æ¢?}
    HasTransition -->|å¦| End
    HasTransition -->|æ˜¯| GetTarget[è·å–ç›®æ ‡çŠ¶æ€]
    
    GetTarget --> CanTransition{å…è®¸è½¬æ¢?}
    CanTransition -->|å¦| End
    CanTransition -->|æ˜¯| ExitOld[é€€å‡ºæ—§çŠ¶æ€]
    
    ExitOld --> EnterNew[è¿›å…¥æ–°çŠ¶æ€]
    EnterNew --> PlayAnim[æ’­æ”¾åŠ¨ç”»]
    PlayAnim --> ApplyEffect[åº”ç”¨è§†è§‰æ•ˆæœ]
    ApplyEffect --> End
```

---

## 8. ç»„ä»¶å›¾ï¼ˆComponent Diagramï¼‰

```mermaid
flowchart TB
    subgraph Unity["Unity Engine"]
        MonoBehaviour
        Rigidbody2D
        Collider2D
        Animator
        SpriteRenderer
    end

    subgraph EnemySystem["æ•ŒäººçŠ¶æ€æœºç³»ç»Ÿ"]
        subgraph Core["æ ¸å¿ƒç»„ä»¶"]
            EnemyController
            EnemyStateMachine
            IEnemyState
            EnemyStateBase
        end

        subgraph States["çŠ¶æ€ç»„ä»¶"]
            subgraph Ground["åœ°é¢çŠ¶æ€"]
                GroundIdle[IdleState]
                GroundPatrol[PatrolState]
                GroundChase[ChaseState]
                GroundAttack[AttackState]
            end

            subgraph Air["é£è¡ŒçŠ¶æ€"]
                AirPatrol[PatrolState]
                AirChase[ChaseState]
                AirAttack[AttackState]
            end

            subgraph Common["é€šç”¨çŠ¶æ€"]
                HurtState
                DeathState
            end
        end

        subgraph Controllers["æ§åˆ¶å™¨"]
            GenericEnemyController
        end
    end

    MonoBehaviour --> EnemyController
    EnemyController --> GenericEnemyController
    GenericEnemyController --> EnemyStateMachine
    EnemyStateMachine --> IEnemyState
    IEnemyState --> EnemyStateBase
    EnemyStateBase --> Ground
    EnemyStateBase --> Air
    EnemyStateBase --> Common

    GenericEnemyController -.-> Rigidbody2D
    GenericEnemyController -.-> Collider2D
    GenericEnemyController -.-> Animator
    GenericEnemyController -.-> SpriteRenderer
```

---

## 9. çŠ¶æ€æœºå¯è§†åŒ–çª—å£ï¼ˆState Machine Visualizerï¼‰

### 9.1 åŠŸèƒ½æ¦‚è¿°

çŠ¶æ€æœºå¯è§†åŒ–çª—å£æ˜¯ä¸€ä¸ªç±»ä¼¼Unity Animatorçš„Canvasé£æ ¼ç¼–è¾‘å™¨å·¥å…·ï¼Œç”¨äºå®æ—¶å¯è§†åŒ–å’Œè°ƒè¯•æ•ŒäººçŠ¶æ€æœºçš„è¿è¡ŒçŠ¶æ€ã€‚

**æ‰“å¼€æ–¹å¼**ï¼š
- èœå•è·¯å¾„ï¼š`Window > æ•ŒäººçŠ¶æ€æœº > çŠ¶æ€æœºå¯è§†åŒ–å™¨ (State Machine Visualizer)`
- å¿«æ·é”®ï¼š`Ctrl + Shift + V`

### 9.2 ä¸»è¦åŠŸèƒ½

#### çŠ¶æ€èŠ‚ç‚¹å¯è§†åŒ–
- **èŠ‚ç‚¹å¸ƒå±€**ï¼šè‡ªåŠ¨å¸ƒå±€æ‰€æœ‰å¯ç”¨çš„çŠ¶æ€èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬ Idleã€Patrolã€Chaseã€Attackã€Hurtã€Death
- **é¢œè‰²ç¼–ç **ï¼šæ¯ä¸ªçŠ¶æ€ä½¿ç”¨ç‹¬ç‰¹çš„é¢œè‰²æ ‡è¯†
  - Idle: é’è‰² (Cyan)
  - Patrol: ç»¿è‰² (Green)
  - Chase: è“è‰² (Blue)
  - Attack: æµ…è“è‰² (Light Blue)
  - Hurt: çº¢è‰² (Red)
  - Death: é»‘è‰²/ç°è‰² (Black/Gray)
- **çŠ¶æ€å›¾æ ‡**ï¼šæ¯ä¸ªçŠ¶æ€é…æœ‰è¡¨æƒ…ç¬¦å·å›¾æ ‡ï¼Œä¾¿äºå¿«é€Ÿè¯†åˆ«
  - ğŸ§ Idle | ğŸš¶ Patrol | ğŸƒ Chase | âš”ï¸ Attack | ğŸ’¥ Hurt | ğŸ’€ Death

#### çŠ¶æ€è½¬æ¢å¯è§†åŒ–
- **è½¬æ¢è¿çº¿**ï¼šæ˜¾ç¤ºçŠ¶æ€ä¹‹é—´çš„è½¬æ¢å…³ç³»ï¼Œå¸¦æœ‰ç®­å¤´æŒ‡ç¤ºæ–¹å‘
- **è½¬æ¢æ ‡ç­¾**ï¼šåœ¨è¿çº¿ä¸Šæ˜¾ç¤ºè½¬æ¢æ¡ä»¶ï¼ˆå¦‚"å‘ç°ç©å®¶"ã€"è¿›å…¥æ”»å‡»èŒƒå›´"ï¼‰
- **ç‰¹æ®Šè½¬æ¢**ï¼šHurt å’Œ Death çŠ¶æ€ä½¿ç”¨è™šçº¿è¡¨ç¤ºå¯ä»ä»»æ„çŠ¶æ€è¿›å…¥

#### è¿è¡Œæ—¶è°ƒè¯•
- **å®æ—¶çŠ¶æ€é«˜äº®**ï¼šå½“å‰æ¿€æ´»çš„çŠ¶æ€èŠ‚ç‚¹ä¼šé«˜äº®æ˜¾ç¤ºå¹¶å¸¦æœ‰ç»¿è‰²æŒ‡ç¤ºå™¨
- **è¿è¡Œæ—¶ä¿¡æ¯é¢æ¿**ï¼šæ˜¾ç¤ºå…³é”®è¿è¡Œæ—¶æ•°æ®
  - State: å½“å‰çŠ¶æ€åç§°
  - Count: å·²æ³¨å†ŒçŠ¶æ€æ•°é‡
  - Health: å½“å‰ç”Ÿå‘½å€¼å’Œç™¾åˆ†æ¯”ï¼ˆå¸¦é¢œè‰²ç¼–ç ï¼‰
  - Alive: å­˜æ´»çŠ¶æ€ï¼ˆâœ…/âŒï¼‰
  - Can Act: å¯è¡ŒåŠ¨çŠ¶æ€ï¼ˆâœ…/âŒï¼‰
- **çŠ¶æ€åˆ‡æ¢**ï¼šè¿è¡Œæ—¶å·¦é”®ç‚¹å‡»çŠ¶æ€èŠ‚ç‚¹å¯å¼ºåˆ¶åˆ‡æ¢åˆ°è¯¥çŠ¶æ€ï¼ˆç”¨äºæµ‹è¯•ï¼‰

#### äº¤äº’æ“ä½œ
- **ç”»å¸ƒæ‹–æ‹½**ï¼šå³é”®æ‹–æ‹½ç§»åŠ¨æ•´ä¸ªç”»å¸ƒè§†å›¾
- **ç¼©æ”¾æ§åˆ¶**ï¼šé¼ æ ‡æ»šè½®ç¼©æ”¾ç”»å¸ƒï¼ˆ0.5x - 2.0xï¼‰
- **è‡ªåŠ¨å¸ƒå±€**ï¼šç‚¹å‡»"ğŸ“ è‡ªåŠ¨å¸ƒå±€"æŒ‰é’®é‡ç½®èŠ‚ç‚¹ä½ç½®
- **é‡ç½®è§†å›¾**ï¼šç‚¹å‡»"ğŸ”„ é‡ç½®"æŒ‰é’®æ¢å¤é»˜è®¤è§†å›¾å’Œç¼©æ”¾

#### å›¾ä¾‹å’Œæç¤º
- **é¢œè‰²å›¾ä¾‹**ï¼šé¡¶éƒ¨æ˜¾ç¤ºæ‰€æœ‰çŠ¶æ€çš„é¢œè‰²æ–¹å—å’Œåç§°
- **æ“ä½œæç¤º**ï¼šåº•éƒ¨æ˜¾ç¤ºäº¤äº’æ“ä½œè¯´æ˜
  - ğŸ’¡ Right-drag canvas | Scroll to zoom | Left-click to switch state (runtime)

### 9.3 ä½¿ç”¨åœºæ™¯

1. **çŠ¶æ€æœºç»“æ„é¢„è§ˆ**ï¼šåœ¨ç¼–è¾‘å™¨ä¸­æŸ¥çœ‹æ•Œäººçš„å®Œæ•´çŠ¶æ€æœºç»“æ„
2. **è¿è¡Œæ—¶è°ƒè¯•**ï¼šå®æ—¶ç›‘æ§æ•Œäººçš„çŠ¶æ€åˆ‡æ¢å’Œå±æ€§å˜åŒ–
3. **å¿«é€Ÿæµ‹è¯•**ï¼šé€šè¿‡ç‚¹å‡»èŠ‚ç‚¹å¿«é€Ÿåˆ‡æ¢çŠ¶æ€ï¼Œæµ‹è¯•å„çŠ¶æ€è¡¨ç°
4. **å…³å¡è®¾è®¡**ï¼šå¸®åŠ©å…³å¡è®¾è®¡å¸ˆç†è§£æ•Œäººçš„è¡Œä¸ºé€»è¾‘

### 9.4 æŠ€æœ¯ç‰¹æ€§

- **è‡ªåŠ¨é€‰æ‹©**ï¼šåœ¨ Hierarchy ä¸­é€‰æ‹©å¸¦æœ‰ `GenericEnemyController` çš„ GameObject æ—¶è‡ªåŠ¨æ›´æ–°æ˜¾ç¤º
- **å®æ—¶åˆ·æ–°**ï¼šè¿è¡Œæ—¶è‡ªåŠ¨åˆ·æ–°æ˜¾ç¤ºï¼Œæ— éœ€æ‰‹åŠ¨æ›´æ–°
- **ç½‘æ ¼èƒŒæ™¯**ï¼šæä¾›ç½‘æ ¼èƒŒæ™¯è¾…åŠ©è§†è§‰å®šä½
- **é˜´å½±æ•ˆæœ**ï¼šèŠ‚ç‚¹å¸¦æœ‰é˜´å½±æ•ˆæœï¼Œå¢å¼ºè§†è§‰å±‚æ¬¡

---

## 10. æ•Œäººç±»å‹é…ç½®

| ç±»å‹ | è¯´æ˜ | ä½¿ç”¨çš„çŠ¶æ€ |
| ---- | ---- | ---------- |
| GroundEnemy | åœ°é¢æ•Œäºº | GroundEnemyXXXState |
| FlyingEnemy | é£è¡Œæ•Œäºº | AirEnemyXXXState |
| BossEnemy | Bossæ•Œäºº | BossStateï¼ˆå¾…å®ç°ï¼‰ |

---

## 11. çŠ¶æ€é¢œè‰²æ–¹æ¡ˆ

| çŠ¶æ€ | é¢œè‰² | RGBå€¼ |
| ---- | ---- | ----- |
| Idle/Patrol | é»˜è®¤ç™½è‰² | (1, 1, 1) |
| Chase | è“è‰² | (0.3, 0.5, 1) |
| Attack | æµ…è“è‰² | (0.4, 0.6, 1) |
| Hurt | é—ªçº¢ | (1, 0, 0) |
| Death | é»‘è‰² | (0, 0, 0) |

---

## 12. å½“å‰å®ç°è¿›åº¦

| çŠ¶æ€ | åœ°é¢æ•Œäºº | é£è¡Œæ•Œäºº |
| ---- | -------- | -------- |
| Idle | âœ… å®Œæˆ | âœ… å®Œæˆ |
| Patrol | âœ… å®Œæˆ | âœ… å®Œæˆ |
| Chase | âœ… å®Œæˆ | âœ… å®Œæˆ |
| Attack | âœ… å®Œæˆ | âœ… å®Œæˆ |
| Hurt | âœ… å®Œæˆ | âœ… å®Œæˆ |
| Death | âœ… å®Œæˆ | âœ… å®Œæˆ |

---

## 13. éªŒæ”¶æ ‡å‡†

- åœ¨æ— ç©å®¶æ—¶ï¼Œæ•Œäººè¡¨ç° Idle/Patrol å¾ªç¯ç¨³å®šæ— ç©¿æ¨¡
- å‘ç°ç©å®¶åèƒ½è¿›å…¥ Chase å¹¶åœ¨å¯æ”»è·ç¦»åˆ‡ Attack
- ç©å®¶è„±ç¦»åæ­£ç¡®å›åˆ° Patrol/Idle
- æ”»å‡»å…·å¤‡å®Œæ•´æ—¶åºï¼Œå†·å´ä¸å‘½ä¸­ç›’æœ‰æ•ˆ
- å—ä¼¤æ—¶æ­£ç¡®æ˜¾ç¤ºé—ªçº¢æ•ˆæœå¹¶åº”ç”¨å‡»é€€
- æ­»äº¡æ—¶æ­£ç¡®æ‰§è¡Œå˜é»‘â†’ç¦ç”¨ç¢°æ’â†’é—ªçƒæ¶ˆå¤±æµç¨‹
- æ—¥å¿—ä¸ Gizmos ç›´è§‚åæ˜ çŠ¶æ€
